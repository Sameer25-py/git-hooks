#!/bin/bash

# Functionality: Prepends type and ticket name to the commit msg e.g feat(TKT-123): <commit message>

# Path to the commit message file
COMMIT_MSG_FILE=$1

# Get the current branch name
BRANCH_NAME=$(git symbolic-ref --short HEAD)

# Extract the feature type and ticket number from branch name
if [[ $BRANCH_NAME =~ ^([^/]+)/([A-Z]+-[0-9]+) ]]; then
    FEATURE_TYPE="${BASH_REMATCH[1]}"
    TICKET_NUMBER="${BASH_REMATCH[2]}"
    
    # Read the existing commit message
    COMMIT_MSG=$(cat $COMMIT_MSG_FILE)
    
    # Skip if the commit message already starts with the desired format
    if [[ $COMMIT_MSG =~ ^$FEATURE_TYPE\($TICKET_NUMBER\): ]]; then
        exit 0
    fi
    
    # Create the new formatted prefix
    NEW_PREFIX="$FEATURE_TYPE($TICKET_NUMBER): "
    
    # Prepend the prefix to the commit message
    echo "$NEW_PREFIX$COMMIT_MSG" > $COMMIT_MSG_FILE
    
    echo "Commit message updated with prefix: $NEW_PREFIX"
fi

exit 0
